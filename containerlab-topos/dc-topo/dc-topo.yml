---
# -------------------------------------------------------------------
# Single DC Topology with external Core L3 Device
# 2 Spines, 6 Leaves with 1 Host Each, 2 Borders with "external" WANs
# Reconfigurable between L2LS and L3LS
# -------------------------------------------------------------------

name: dc-topo

mgmt:
  network: clab_mgmt
  bridge: br0
  ipv4_subnet: 10.99.99.0/24
  ipv4-gw: 10.99.99.1

topology:

  defaults:
    env:
      INTFTYPE: et

  nodes: 

#########################
# SPINE                 #
#########################

    SPINE1:
      kind: ceos
      image: ceos:4.28.0F
      mgmt_ipv4: 10.99.99.2
      startup-config: ./configs/SPINE1.cfg
      binds:
        - ./configs/spine-mappings.json:/mnt/flash/EosIntfMapping.json:ro

    SPINE2:
      kind: ceos
      image: ceos:4.28.0F
      mgmt_ipv4: 10.99.99.3
      startup-config: ./configs/SPINE2.cfg
      binds:
        - ./configs/spine-mappings.json:/mnt/flash/EosIntfMapping.json:ro

#########################
# LEAF                  #
#########################

    LEAF1:
      kind: ceos
      image: ceos:4.28.0F
      mgmt_ipv4: 10.99.99.4
      startup-config: ./configs/LEAF1.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro

    LEAF2:
      kind: ceos
      image: ceos:4.28.0F
      mgmt_ipv4: 10.99.99.5
      startup-config: ./configs/LEAF2.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro

    LEAF3:
      kind: ceos
      image: ceos:4.28.0F
      mgmt_ipv4: 10.99.99.6
      startup-config: ./configs/LEAF3.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro

    LEAF4:
      kind: ceos
      image: ceos:4.28.0F
      mgmt_ipv4: 10.99.99.7
      startup-config: ./configs/LEAF4.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro

    LEAF5:
      kind: ceos
      image: ceos:4.28.0F
      mgmt_ipv4: 10.99.99.8
      startup-config: ./configs/LEAF5.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro

    LEAF6:
      kind: ceos
      image: ceos:4.28.0F
      mgmt_ipv4: 10.99.99.9
      startup-config: ./configs/LEAF6.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro

#########################
# BORDER                #
#########################

    BORDER1:
      kind: ceos
      image: ceos:4.28.0F
      mgmt_ipv4: 10.99.99.10
      startup-config: ./configs/BORDER1.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro

    BORDER2:
      kind: ceos
      image: ceos:4.28.0F
      mgmt_ipv4: 10.99.99.11
      startup-config: ./configs/BORDER2.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro

###########################################
# HOST                                    #
###########################################

    HOST1:
      kind: ceos
      image: ceos:4.28.0F
      mgmt_ipv4: 10.99.99.12
      startup-config: ./configs/HOST1.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro

    HOST2:
      kind: ceos
      image: ceos:4.28.0F
      mgmt_ipv4: 10.99.99.13
      startup-config: ./configs/HOST2.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro

    HOST3:
      kind: ceos
      image: ceos:4.28.0F
      mgmt_ipv4: 10.99.99.14
      startup-config: ./configs/HOST3.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro

###########################################
# WAN Simulation                          #
###########################################

    WAN1:
      kind: ceos
      image: ceos:4.28.0F
      mgmt_ipv4: 10.99.99.15
      startup-config: ./configs/WAN1.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro

    WAN2:
      kind: ceos
      image: ceos:4.28.0F
      mgmt_ipv4: 10.99.99.16
      startup-config: ./configs/WAN2.cfg
      binds:
        - ./configs/leaf-mappings.json:/mnt/flash/EosIntfMapping.json:ro

  links:
####################
# SPINE1 to LEAF   #
####################
    - endpoints: ["SPINE1:et1", "LEAF1:et3"]
    - endpoints: ["SPINE1:et2", "LEAF2:et3"]
    - endpoints: ["SPINE1:et3", "LEAF3:et3"]
    - endpoints: ["SPINE1:et4", "LEAF4:et3"]
    - endpoints: ["SPINE1:et5", "LEAF5:et3"]
    - endpoints: ["SPINE1:et6", "LEAF6:et3"]
    - endpoints: ["SPINE1:et7", "BORDER1:et3"]
    - endpoints: ["SPINE1:et8", "BORDER2:et3"]
####################
# SPINE2 to LEAF   #
####################
    - endpoints: ["SPINE2:et1", "LEAF1:et4"]
    - endpoints: ["SPINE2:et2", "LEAF2:et4"]
    - endpoints: ["SPINE2:et3", "LEAF3:et4"]
    - endpoints: ["SPINE2:et4", "LEAF4:et4"]
    - endpoints: ["SPINE2:et5", "LEAF5:et4"]
    - endpoints: ["SPINE2:et6", "LEAF6:et4"]
    - endpoints: ["SPINE2:et7", "BORDER1:et4"]
    - endpoints: ["SPINE2:et8", "BORDER2:et4"]
####################
# SPINE1 to SPINE2 #
####################
    - endpoints: ["SPINE1:et9", "SPINE2:et9"]
    - endpoints: ["SPINE1:et10", "SPINE2:et10"]
####################
# LEAF1 to LEAF2   #
####################
    - endpoints: ["LEAF1:et9", "LEAF2:et9"]
    - endpoints: ["LEAF1:et10", "LEAF2:et10"]
####################
# HOST1            #
####################
    - endpoints: ["HOST1:et1", "LEAF1:et1"]
    - endpoints: ["HOST1:et2", "LEAF2:et1"]
####################
# LEAF3 to LEAF4   #
####################
    - endpoints: ["LEAF3:et9", "LEAF4:et9"]
    - endpoints: ["LEAF3:et10", "LEAF4:et10"]
####################
# HOST2            #
####################
    - endpoints: ["HOST2:et1", "LEAF3:et1"]
    - endpoints: ["HOST2:et2", "LEAF4:et1"]
####################
# LEAF5 to LEAF6   #
####################
    - endpoints: ["LEAF5:et9", "LEAF6:et9"]
    - endpoints: ["LEAF5:et10", "LEAF6:et10"]
####################
# HOST3            #
####################
    - endpoints: ["HOST3:et1", "LEAF5:et1"]
    - endpoints: ["HOST3:et2", "LEAF6:et1"]
########################
# BORDER1 to BORDER2   #
########################
    - endpoints: ["BORDER1:et9", "BORDER2:et9"]
    - endpoints: ["BORDER1:et10", "BORDER2:et10"]
######################
# WAN Sim            #
######################
    - endpoints: ["WAN1:et1", "BORDER1:et1"]
    - endpoints: ["WAN2:et1", "BORDER2:et1"]