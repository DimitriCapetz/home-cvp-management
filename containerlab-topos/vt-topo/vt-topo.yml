---
# --------------------------------------------------------------------------
# Simulation of SP Core Rings with L2 / L3 External Connections
# 12 Sites with Redundant PEs and L3 Transport
# External WAN Simulation and Hosts
# --------------------------------------------------------------------------

name: vt-topo
prefix: ""

mgmt:
  network: clab_mgmt
  bridge: br0
  ipv4_subnet: 10.99.99.0/24
  ipv4-gw: 10.99.99.1

topology:

  kinds:
    ceos:
      image: ceos:4.28.2F
    linux:
      image: mitchv85/ohv-host

  nodes: 

###########################################
# Graphite Node                           #
# Provides Topology Graphing and the      #
# ability to connect to nodes in the      #
# topology via a web/ssh session          #
###########################################

    graphite:
      kind: linux
      image: netreplica/graphite
      mgmt_ipv4: 10.99.99.87
      env:
        GRAPHITE_DEFAULT_TYPE: clab
        GRAPHITE_DEFAULT_TOPO: vt-topo
        # CLAB_SSH_CONNECTION: ${SSH_CONNECTION}
      binds:
        # - .:/var/www/localhost/htdocs/clab   <----  This is the old path in docker image netreplica/graphite:webssh2
        - .:/htdocs/clab    # New path required for latest version
      ports:
        - 80:80
      exec:
        # - sh -c 'generate_offline_graph.sh'   # used to generate offline graphs
        - sh -c 'graphite_motd.sh 80'
      labels:
        graph-hide: yes

########
# CLEC #
########

    DE-SMET-1:
      kind: ceos
      mgmt_ipv4: 10.99.99.122
      startup-config: ./configs/DE-SMET-1.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 2
        graph-icon: switch

    DE-SMET-2:
      kind: ceos
      mgmt_ipv4: 10.99.99.123
      startup-config: ./configs/DE-SMET-2.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 2
        graph-icon: switch

    VOLGA-1:
      kind: ceos
      mgmt_ipv4: 10.99.99.124
      startup-config: ./configs/VOLGA-1.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 1
        graph-icon: switch

    VOLGA-2:
      kind: ceos
      mgmt_ipv4: 10.99.99.125
      startup-config: ./configs/VOLGA-2.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 1
        graph-icon: switch

    FLANDREAU-1:
      kind: ceos
      mgmt_ipv4: 10.99.99.126
      startup-config: ./configs/FLANDREAU-1.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 2
        graph-icon: switch

    FLANDREAU-2:
      kind: ceos
      mgmt_ipv4: 10.99.99.127
      startup-config: ./configs/FLANDREAU-2.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 2
        graph-icon: switch

###################
# SDN Carrier Sim #
###################

    SDN-SIM:
      kind: ceos
      mgmt_ipv4: 10.99.99.128
      startup-config: ./configs/SDN-SIM.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 3
        graph-icon: switch

########
# ILEC #
########

    HOSMER-1:
      kind: ceos
      mgmt_ipv4: 10.99.99.129
      startup-config: ./configs/HOSMER-1.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 4
        graph-icon: switch

    HOSMER-2:
      kind: ceos
      mgmt_ipv4: 10.99.99.130
      startup-config: ./configs/HOSMER-2.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 4
        graph-icon: switch

    IPSWITCH-1:
      kind: ceos
      mgmt_ipv4: 10.99.99.131
      startup-config: ./configs/IPSWITCH-1.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 5
        graph-icon: switch

    IPSWITCH-2:
      kind: ceos
      mgmt_ipv4: 10.99.99.132
      startup-config: ./configs/IPSWITCH-2.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 5
        graph-icon: switch

    MOUND-CITY-1:
      kind: ceos
      mgmt_ipv4: 10.99.99.133
      startup-config: ./configs/MOUND-CITY-1.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 5
        graph-icon: switch

    MOUND-CITY-2:
      kind: ceos
      mgmt_ipv4: 10.99.99.134
      startup-config: ./configs/MOUND-CITY-2.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 5
        graph-icon: switch

    LEOLA-1:
      kind: ceos
      mgmt_ipv4: 10.99.99.135
      startup-config: ./configs/LEOLA-1.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 6
        graph-icon: switch

    LEOLA-2:
      kind: ceos
      mgmt_ipv4: 10.99.99.136
      startup-config: ./configs/LEOLA-2.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 6
        graph-icon: switch

    GLENHAM-1:
      kind: ceos
      mgmt_ipv4: 10.99.99.137
      startup-config: ./configs/GLENHAM-1.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 6
        graph-icon: switch

    GLENHAM-2:
      kind: ceos
      mgmt_ipv4: 10.99.99.138
      startup-config: ./configs/GLENHAM-2.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 6
        graph-icon: switch

    LONG-LAKE-1:
      kind: ceos
      mgmt_ipv4: 10.99.99.139
      startup-config: ./configs/LONG-LAKE-1.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 7
        graph-icon: switch

    LONG-LAKE-2:
      kind: ceos
      mgmt_ipv4: 10.99.99.140
      startup-config: ./configs/LONG-LAKE-2.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 7
        graph-icon: switch

    POLLOCK-1:
      kind: ceos
      mgmt_ipv4: 10.99.99.141
      startup-config: ./configs/POLLOCK-1.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 7
        graph-icon: switch

    POLLOCK-2:
      kind: ceos
      mgmt_ipv4: 10.99.99.142
      startup-config: ./configs/POLLOCK-2.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 7
        graph-icon: switch

    EUREKA-1:
      kind: ceos
      mgmt_ipv4: 10.99.99.143
      startup-config: ./configs/EUREKA-1.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 8
        graph-icon: switch

    EUREKA-2:
      kind: ceos
      mgmt_ipv4: 10.99.99.144
      startup-config: ./configs/EUREKA-2.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 8
        graph-icon: switch

    HERREID-1:
      kind: ceos
      mgmt_ipv4: 10.99.99.145
      startup-config: ./configs/HERREID-1.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 8
        graph-icon: switch

    HERREID-2:
      kind: ceos
      mgmt_ipv4: 10.99.99.146
      startup-config: ./configs/HERREID-2.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 8
        graph-icon: switch

###############
# L2 Services #
###############

    EUREKA-ACCESS:
      kind: linux
      image: mitchv85/ohv-host
      mgmt_ipv4: 10.99.99.147
      exec:
        - bash /usr/local/bin/hostnetconfig.sh -b -i 10.110.110.101/24 -g 10.110.110.1
      labels:
        graph-level: 9
        graph-icon: host

    IPSWITCH-ACCESS:
      kind: linux
      image: mitchv85/ohv-host
      mgmt_ipv4: 10.99.99.148
      exec:
        - bash /usr/local/bin/hostnetconfig.sh -b -i 10.50.50.101/24 -g 10.50.50.1
      labels:
        graph-level: 5
        graph-icon: host

    DE-SMET-ACCESS:
      kind: linux
      image: mitchv85/ohv-host
      mgmt_ipv4: 10.99.99.149
      exec:
        - bash /usr/local/bin/hostnetconfig.sh -b -i 10.10.10.101/24 -g 10.10.10.1
      labels:
        graph-level: 1
        graph-icon: host

    FLANDREAU-TOWER:
      kind: linux
      image: mitchv85/ohv-host
      mgmt_ipv4: 10.99.99.150
      exec:
        - bash /usr/local/bin/hostnetconfig.sh -i 192.168.1.101/24 -g 192.168.1.1
      labels:
        graph-level: 1
        graph-icon: host

    LONG-LAKE-TOWER:
      kind: linux
      image: mitchv85/ohv-host
      mgmt_ipv4: 10.99.99.151
      exec:
        - bash /usr/local/bin/hostnetconfig.sh -i 192.168.2.101/24 -g 192.168.2.1
      labels:
        graph-level: 1
        graph-icon: host

    L2-UPSTREAM:
      kind: ceos
      mgmt_ipv4: 10.99.99.152
      startup-config: ./configs/L2-UPSTREAM.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 10
        graph-icon: switch

##########################
# Upstream L3 Simulation #
##########################

    HERREID-CORE-ROUTER:
      kind: ceos
      mgmt_ipv4: 10.99.99.153
      startup-config: ./configs/HERREID-CORE-ROUTER.cfg
      binds:
        - ./configs/7280SR3-40YC6-mappings.json:/mnt/flash/EosIntfMapping.json:ro
      labels:
        graph-level: 9
        graph-icon: switch

  links:
##############
# Peer-links #
##############
    - endpoints: ["DE-SMET-1:eth9", "DE-SMET-2:eth9"]
    - endpoints: ["DE-SMET-1:eth10", "DE-SMET-2:eth10"]
    - endpoints: ["VOLGA-1:eth9", "VOLGA-2:eth9"]
    - endpoints: ["VOLGA-1:eth10", "VOLGA-2:eth10"]
    - endpoints: ["FLANDREAU-1:eth9", "FLANDREAU-2:eth9"]
    - endpoints: ["FLANDREAU-1:eth10", "FLANDREAU-2:eth10"]
    - endpoints: ["HOSMER-1:eth9", "HOSMER-2:eth9"]
    - endpoints: ["HOSMER-1:eth10", "HOSMER-2:eth10"]
    - endpoints: ["IPSWITCH-1:eth9", "IPSWITCH-2:eth9"]
    - endpoints: ["IPSWITCH-1:eth10", "IPSWITCH-2:eth10"]
    - endpoints: ["MOUND-CITY-1:eth9", "MOUND-CITY-2:eth9"]
    - endpoints: ["MOUND-CITY-1:eth10", "MOUND-CITY-2:eth10"]
    - endpoints: ["LEOLA-1:eth9", "LEOLA-2:eth9"]
    - endpoints: ["LEOLA-1:eth10", "LEOLA-2:eth10"]
    - endpoints: ["GLENHAM-1:eth9", "GLENHAM-2:eth9"]
    - endpoints: ["GLENHAM-1:eth10", "GLENHAM-2:eth10"]
    - endpoints: ["LONG-LAKE-1:eth9", "LONG-LAKE-2:eth9"]
    - endpoints: ["LONG-LAKE-1:eth10", "LONG-LAKE-2:eth10"]
    - endpoints: ["EUREKA-1:eth9", "EUREKA-2:eth9"]
    - endpoints: ["EUREKA-1:eth10", "EUREKA-2:eth10"]
    - endpoints: ["HERREID-1:eth9", "HERREID-2:eth9"]
    - endpoints: ["HERREID-1:eth10", "HERREID-2:eth10"]
    - endpoints: ["POLLOCK-1:eth9", "POLLOCK-2:eth9"]
    - endpoints: ["POLLOCK-1:eth10", "POLLOCK-2:eth10"]
#############
# CLEC Ring #
#############
    - endpoints: ["DE-SMET-2:eth5", "VOLGA-1:eth5"]
    - endpoints: ["VOLGA-2:eth5", "FLANDREAU-1:eth5"]
    - endpoints: ["DE-SMET-1:eth5", "SDN-SIM:eth5"]
    - endpoints: ["FLANDREAU-2:eth5", "SDN-SIM:eth6"]
#############
# ILEC Ring #
#############
    - endpoints: ["HOSMER-2:eth5", "MOUND-CITY-1:eth5"]
    - endpoints: ["MOUND-CITY-2:eth5", "GLENHAM-1:eth5"]
    - endpoints: ["GLENHAM-2:eth5", "POLLOCK-1:eth5"]
    - endpoints: ["POLLOCK-2:eth5", "HERREID-1:eth5"]
    - endpoints: ["HERREID-2:eth5", "EUREKA-1:eth5"]
    - endpoints: ["EUREKA-2:eth5", "LONG-LAKE-1:eth5"]
    - endpoints: ["LONG-LAKE-2:eth5", "LEOLA-1:eth5"]
    - endpoints: ["LEOLA-2:eth5", "IPSWITCH-1:eth5"]
    - endpoints: ["IPSWITCH-2:eth5", "HOSMER-1:eth5"]
################
# ILEC to CLEC #
################
    - endpoints: ["MOUND-CITY-1:eth6", "SDN-SIM:eth7"]
    - endpoints: ["GLENHAM-2:eth6", "SDN-SIM:eth8"]
##################
# ACCESS CHASSIS #
##################
    - endpoints: ["DE-SMET-ACCESS:eth1", "DE-SMET-1:eth1"]
    - endpoints: ["DE-SMET-ACCESS:eth2", "DE-SMET-2:eth1"]
    - endpoints: ["EUREKA-ACCESS:eth1", "EUREKA-1:eth1"]
    - endpoints: ["EUREKA-ACCESS:eth2", "EUREKA-2:eth1"]
    - endpoints: ["IPSWITCH-ACCESS:eth1", "IPSWITCH-1:eth1"]
    - endpoints: ["IPSWITCH-ACCESS:eth2", "IPSWITCH-2:eth1"]
###############
# CELL TOWERS #
###############
    - endpoints: ["FLANDREAU-TOWER:eth1", "FLANDREAU-1:eth2"]
    - endpoints: ["LONG-LAKE-TOWER:eth1", "LONG-LAKE-2:eth2"]
################
# ILEC to Edge #
################
    - endpoints: ["HERREID-1:eth7", "HERREID-CORE-ROUTER:eth7"]
    - endpoints: ["HERREID-2:eth7", "HERREID-CORE-ROUTER:eth8"]
###############
# L2 Upstream #
###############
    - endpoints: ["L2-UPSTREAM:eth1", "HERREID-CORE-ROUTER:eth1"]